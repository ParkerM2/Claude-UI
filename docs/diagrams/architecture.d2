# Claude UI Architecture
# Simple vertical flow: External → Main → Bridge → Renderer

direction: down

vars: {
  d2-config: {
    theme-id: 200
    layout-engine: elk
  }
}

# ============================================
# EXTERNAL SERVICES (Top)
# ============================================
external: External APIs {
  style: {
    fill: "#1e1e30"
    stroke: "#f59e0b"
    stroke-width: 5
    border-radius: 20
    font-size: 36
    bold: true
  }

  hub: Hub Server {
    icon: https://cdn.jsdelivr.net/gh/devicons/devicon/icons/fastify/fastify-original.svg
    style.fill: "#16213e"
    style.stroke: "#f59e0b"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }

  anthropic: Anthropic API {
    style.fill: "#16213e"
    style.stroke: "#D97706"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }

  github: GitHub API {
    icon: https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg
    style.fill: "#16213e"
    style.stroke: "#ffffff"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }

  oauth: OAuth Services {
    style.fill: "#16213e"
    style.stroke: "#a855f7"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }
}

# ============================================
# MAIN PROCESS (Electron Backend)
# ============================================
main: Main Process - Electron + Node.js {
  style: {
    fill: "#1a1a2e"
    stroke: "#10b981"
    stroke-width: 5
    border-radius: 20
    font-size: 36
    bold: true
  }

  services: Backend Services {
    style.fill: "#16213e"
    style.stroke: "#10b981"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }

  ipc: IPC Router {
    style.fill: "#16213e"
    style.stroke: "#f59e0b"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }

  storage: Local Storage {
    style.fill: "#16213e"
    style.stroke: "#8b5cf6"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }
}

# ============================================
# PRELOAD BRIDGE
# ============================================
bridge: Preload Bridge - window.api {
  style: {
    fill: "#0f3460"
    stroke: "#e94560"
    stroke-width: 5
    border-radius: 20
    font-size: 36
    bold: true
  }

  invoke: api.invoke() {
    style.fill: "#16213e"
    style.stroke: "#e94560"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }

  events: api.on() {
    style.fill: "#16213e"
    style.stroke: "#22d3ee"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }
}

# ============================================
# RENDERER (React Frontend)
# ============================================
renderer: Renderer - React 19 {
  style: {
    fill: "#1a1a2e"
    stroke: "#4f46e5"
    stroke-width: 5
    border-radius: 20
    font-size: 36
    bold: true
  }

  query: React Query {
    style.fill: "#16213e"
    style.stroke: "#FF4154"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }

  zustand: Zustand Stores {
    style.fill: "#16213e"
    style.stroke: "#764ABC"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }

  components: UI Components {
    icon: https://cdn.jsdelivr.net/gh/devicons/devicon/icons/react/react-original.svg
    style.fill: "#16213e"
    style.stroke: "#61DAFB"
    style.stroke-width: 3
    style.border-radius: 12
    style.font-size: 28
  }
}

# ============================================
# CONNECTIONS - All flow DOWN
# ============================================

# External → Main Services (straight down)
external.hub -> main.services: WebSocket {
  style.stroke: "#f59e0b"
  style.stroke-width: 4
  style.animated: true
  style.font-size: 24
}

external.anthropic -> main.services: SDK {
  style.stroke: "#D97706"
  style.stroke-width: 4
  style.animated: true
  style.font-size: 24
}

external.github -> main.services: REST {
  style.stroke: "#ffffff"
  style.stroke-width: 4
  style.animated: true
  style.font-size: 24
}

external.oauth -> main.services: OAuth2 {
  style.stroke: "#a855f7"
  style.stroke-width: 4
  style.animated: true
  style.font-size: 24
}

# Main → Bridge
main.ipc -> bridge.invoke {
  style.stroke: "#10b981"
  style.stroke-width: 4
  style.animated: true
}

main.services -> bridge.events: emit {
  style.stroke: "#22d3ee"
  style.stroke-width: 4
  style.animated: true
  style.font-size: 24
}

# Bridge → Renderer
bridge.invoke -> renderer.query {
  style.stroke: "#e94560"
  style.stroke-width: 4
  style.animated: true
}

bridge.events -> renderer.query: events {
  style.stroke: "#22d3ee"
  style.stroke-width: 4
  style.animated: true
  style.font-size: 24
}

# Internal renderer flow
renderer.query -> renderer.components {
  style.stroke: "#FF4154"
  style.stroke-width: 3
  style.stroke-dash: 5
}

renderer.zustand -> renderer.components {
  style.stroke: "#764ABC"
  style.stroke-width: 3
  style.stroke-dash: 5
}
